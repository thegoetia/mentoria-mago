<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel Admin</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    body {
      user-select: none;
    }
    video {
      pointer-events: none;
    }
  </style>

  <script>
    // Bloqueia botão direito
    document.addEventListener("contextmenu", (e) => e.preventDefault());

    // Bloqueia arrastar
    document.addEventListener("dragstart", (e) => e.preventDefault());
  </script>
</head>
<body>

  <div class="container">
    <h1>Painel Admin</h1>

    <div class="form-box">
      <h2>Enviar nova aula</h2>

      <input type="text" id="lesson-title" placeholder="Título da aula" />

      <input type="text" id="lesson-link" placeholder="Cole o link da aula (Drive, YouTube, Dropbox...)" />

      <button id="send-btn">Enviar Aula</button>

      <p id="status"></p>
    </div>

    <hr />

    <h2>Aulas enviadas</h2>
    <ul id="lessons-list"></ul>

  </div>

  <script>
    const sendBtn = document.getElementById("send-btn");
    const statusText = document.getElementById("status");
    const list = document.getElementById("lessons-list");

    async function loadLessons() {
      const res = await fetch("/api/getLessons");
      const data = await res.json();

      list.innerHTML = "";

      data.lessons
        .sort((a, b) => a.createdAt - b.createdAt)
        .forEach((lesson) => {
          let li = document.createElement("li");
          li.innerHTML = `
            <strong>${lesson.title}</strong><br>
            <video width="400" controls src="${lesson.finalUrl}"></video>
          `;
          list.appendChild(li);
        });
    }

    sendBtn.onclick = async () => {
      const title = document.getElementById("lesson-title").value.trim();
      const link = document.getElementById("lesson-link").value.trim();

      if (!title || !link) {
        statusText.innerText = "Preencha todos os campos!";
        return;
      }

      statusText.innerText = "Processando link...";

      const res = await fetch("/api/processLink", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, link })
      });

      const data = await res.json();

      if (!data.success) {
        statusText.innerText = "Erro ao processar link!";
        return;
      }

      statusText.innerText = "Aula enviada com sucesso!";
      document.getElementById("lesson-title").value = "";
      document.getElementById("lesson-link").value = "";

      loadLessons();
    };

    loadLessons();
  </script>

</body>
</html>

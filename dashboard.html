<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meu Painel • Mentoria</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <script src="firebase.js"></script>
  <script src="auth.js" defer></script>

  <style>
    /* Player padrão, responsivo 16:9 */

    .video-card{ width:100%; margin-bottom:30px; }

    .iframe-protect{
      position:relative;
      width:100%;
      padding-top:56.25%; /* 16:9 */
      background:#000;
      border-radius:12px;
      overflow:hidden;
    }

    .iframe-protect iframe{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      border:0;
      pointer-events:auto;
    }

    .video-title{
      margin-top:10px;
      font-weight:600;
      text-align:center;
    }
  </style>

</head>
<body oncontextmenu="return false">

<header class="site-header">
  <div class="container header-inner">
    <h2>Mentoria</h2>
    <div class="header-actions">
      <span id="userName" class="muted"></span>
      <button data-theme-toggle class="btn small" onclick="Theme.toggle()">Light</button>
      <button data-logout class="btn ghost">Sair</button>
    </div>
  </div>
</header>

<main class="container">
  <section id="dashboard-content" class="content-area" style="display:none">
    <div class="welcome card">
      <h1>Bem-vindo</h1>
      <p>Abaixo estão as mentorias disponíveis para você (ordem cronológica).</p>
    </div>

    <div id="videosList" class="videos-grid"></div>
  </section>
</main>

<script>

firebase.auth().onAuthStateChanged(async (user) => {
  if (!user) return window.location.href = 'index.html';

  const list = document.getElementById('videosList');
  list.innerHTML = '';

  let snap;
  try{
    snap = await firebase.firestore().collection('videos')
      .orderBy('createdAt','asc')
      .get();
  } catch(e){
    snap = await firebase.firestore().collection('videos').get();
  }

  if(snap.empty){
    list.innerHTML = '<p>Nenhum vídeo disponível.</p>';
    document.getElementById('dashboard-content').style.display = 'block';
    return;
  }

  snap.forEach(doc => {
    const d = doc.data();
    const ytId = d.ytId;
    if(!ytId) return;

    const embedUrl =
      `https://www.youtube.com/embed/${ytId}?rel=0&modestbranding=1&controls=1`;

    const card = document.createElement('div');
    card.className = 'video-card';

    card.innerHTML = `
      <div class="iframe-protect" oncontextmenu="return false;">
        <iframe
          src="${embedUrl}"
          allow="encrypted-media; picture-in-picture; fullscreen"
          allowfullscreen>
        </iframe>
      </div>
      <div class="video-title">${escapeHtml(d.title || 'Mentoria')}</div>
    `;

    list.appendChild(card);
  });

  document.getElementById('dashboard-content').style.display = 'block';
});

// helper
function escapeHtml(s){
  if(!s) return '';
  return s.replace(/[&<>"'\/]/g, c => ({
    '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;', '/':'&#x2F;'
  })[c]);
}

// bloqueios básicos
document.addEventListener('keydown', e => {
  if (e.ctrlKey){
    const block = ['u','s','c','i','p'];
    if (block.includes(e.key.toLowerCase())) e.preventDefault();
  }
});

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="dashboard-content" style="display:none">
    <h1>Bem-vindo à Mentoria</h1>
    <button id="logout">Sair</button>

    <div id="video-list"></div>
</div>

<!-- BLOQUEIO DE BOTÃO DIREITO + TECLAS -->
<script>
// Botão direito
document.addEventListener("contextmenu", e => e.preventDefault());

// Bloqueio de teclas
document.addEventListener("keydown", e => {
    if (e.key === "F12") e.preventDefault();
    if (e.ctrlKey && ["u","c","v","s","a","p"].includes(e.key.toLowerCase())) e.preventDefault();
    if (e.ctrlKey && e.shiftKey && ["i","j","c"].includes(e.key.toLowerCase())) e.preventDefault();
});
</script>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { 
    collection, getDocs, orderBy, query, doc, getDoc 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

onAuthStateChanged(auth, async (user) => {
    if (!user) {
        window.location.href = "index.html";
        return;
    }

    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    if (!snap.exists() || snap.data().authorized !== true) {
        alert("Sua conta ainda não foi autorizada.");
        await signOut(auth);
        window.location.href = "index.html";
        return;
    }

    document.getElementById("dashboard-content").style.display = "block";
    loadVideos();
});

async function loadVideos() {
    const list = document.getElementById("video-list");
    list.innerHTML = "";

    const q = query(collection(db, "videos"), orderBy("createdAt", "asc"));
    const snap = await getDocs(q);

    snap.forEach((docSnap) => {
        const data = docSnap.data();

        const wrapper = document.createElement("div");
        wrapper.classList.add("video-wrapper");

        wrapper.innerHTML = `
            <div class="video-overlay" onclick="playVideo(this)"></div>
            <iframe class="video-frame" src="${data.url}" allowfullscreen></iframe>
            <div class="play-button">▶</div>
            <h3>${data.title}</h3>
        `;

        list.appendChild(wrapper);
    });
}

window.playVideo = (overlay) => {
    const parent = overlay.parentElement;
    const iframe = parent.querySelector(".video-frame");
    const play = parent.querySelector(".play-button");

    iframe.style.pointerEvents = "auto";
    overlay.style.display = "none";
    play.style.display = "none";
};

document.getElementById("logout").onclick = () => signOut(auth);
</script>

</body>
</html>
